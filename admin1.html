<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Website Sales</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

    <style>
        body {
            font-family: 'Lexend', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Sidebar Navigation */
        .nav-link { @apply flex items-center px-4 py-2.5 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-white transition-colors duration-200; }
        .nav-link.active { @apply bg-indigo-600 text-white font-semibold shadow-inner; }

        /* Main Content */
        .page-content { @apply p-4 sm:p-6 lg:p-8; }
        .section-card { @apply bg-white p-6 rounded-xl shadow-lg; }
        .section-header { @apply text-xl font-bold text-gray-800 mb-6 border-b border-gray-200 pb-4 capitalize; }
        
        /* Form Styles */
        .form-group { @apply flex flex-col sm:flex-row sm:items-start sm:gap-4 mb-5; }
        .form-label { @apply block text-base font-semibold text-gray-700 sm:w-1/3 pt-2; } 
        .form-field-container { @apply w-full sm:w-2/3; }
        .form-input, .form-textarea {
            @apply w-full rounded-lg border-2 border-gray-300 bg-white shadow-sm px-4 py-2.5 
                   text-base text-gray-900 placeholder:text-gray-400 
                   focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 
                   transition-all duration-150;
        }

        /* Dynamic Entry Styles */
        .dynamic-entry { @apply bg-slate-50 shadow-md p-5 pl-12 rounded-xl relative border border-gray-200; }
        .delete-btn { @apply absolute -top-3 -right-3 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-2xl hover:bg-red-600 transition-transform hover:scale-110 z-10; }
        .drag-handle { @apply absolute top-1/2 -translate-y-1/2 left-4 cursor-move text-gray-400 hover:text-gray-700 text-xl; }

        /* Image Editor Styles REVISED */
        .image-preview-container { @apply relative w-full p-2 border-2 border-dashed border-gray-200 rounded-lg text-center cursor-pointer hover:border-indigo-400 bg-slate-50 transition-colors overflow-hidden flex items-center justify-center; }
        .image-preview-container .overlay { @apply absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-60 flex items-end justify-start p-2 text-white opacity-0 hover:opacity-100 transition-all duration-300; }
        .image-preview-container .overlay-button { @apply bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold px-3 py-1.5 rounded-full flex items-center gap-2 shadow-lg; }
        .image-preview, .image-preview-wide { @apply w-full h-full object-contain; } /* REVISED: Use object-contain to see the whole image */
        .cropper-actions { @apply mt-2 flex justify-end space-x-2; }

        /* Modal Styles */
        .modal-backdrop { @apply fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity; }
        .modal-content { @apply bg-slate-50 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col; }
        .modal-body { @apply p-6 overflow-y-auto; }
        .modal-close-btn { @apply text-gray-500 hover:text-gray-800 font-sans font-bold text-2xl leading-none; }

        /* Mobil List Item Style */
        .mobil-list-item { @apply flex items-center gap-4 bg-white p-3 rounded-lg border shadow-sm; }
        .mobil-list-item .drag-handle-mobil { @apply cursor-move text-gray-400 text-xl pr-2; }
        .mobil-list-item .action-btn { @apply px-3 py-1.5 text-sm font-semibold rounded-md; }
    </style>
</head>
<body class="flex h-screen">

    <aside class="w-64 bg-slate-800 text-slate-300 flex-shrink-0 flex flex-col">
        <div class="h-16 flex items-center justify-center text-white text-xl font-bold border-b border-slate-700 px-4">
            <span id="sidebar-brand-name" class="truncate">Admin Panel</span>
        </div>
        <nav id="sidebar-nav" class="flex-1 px-4 py-6 space-y-2">
            <a href="#branding" data-page="branding" class="nav-link active"><span>Branding & Personal Info</span></a>
            <hr class="border-slate-700 my-2">
            <a href="#judul" data-page="judul" class="nav-link"><span>Bagian Judul & Slide</span></a>
            <hr class="border-slate-700 my-2">
            <a href="#mobil" data-page="mobil" class="nav-link"><span>Daftar Mobil</span></a>
            <hr class="border-slate-700 my-2">
            <a href="#promo" data-page="promo" class="nav-link"><span>Promo</span></a>
            <hr class="border-slate-700 my-2">
            <a href="#testimoni" data-page="testimoni" class="nav-link"><span>Testimoni</span></a>
            <hr class="border-slate-700 my-2">
            <a href="#galeri" data-page="galeri" class="nav-link"><span>Galeri Penyerahan</span></a>
            <hr class="border-slate-700 my-2">
            <a href="#data" data-page="data" class="nav-link"><span>Manajemen Data</span></a>
        </nav>
        <div class="px-4 py-4 border-t border-slate-700">
            <a href="index1.html" target="_blank" class="nav-link bg-blue-600 text-white font-semibold hover:bg-blue-500 justify-center">
                <span>Lihat Website</span>
            </a>
        </div>
    </aside>

    <div class="flex-1 flex flex-col overflow-hidden ml-6">
        <header class="h-16 bg-white shadow-sm flex items-center justify-between px-6 flex-shrink-0 z-10">
            <h1 id="page-title" class="text-xl font-semibold text-slate-800 capitalize">Branding & Personal Info</h1>
            <div class="flex items-center space-x-4">
                 <img id="topbar-logo" src="https://placehold.co/40x40/e2e8f0/334155?text=A" alt="Admin" class="w-8 h-8 rounded-full mr-2 object-cover">
                 <span id="topbar-admin-name" class="text-slate-700 font-medium hidden sm:block">Sales Person</span>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto bg-slate-100">
            <form id="admin-form" novalidate>
                <div id="page-branding" class="page-content">
                    <div class="section-card">
                        <h2 class="section-header">Branding & Personal Info</h2>
                        <div class="form-group"><label for="brandName" class="form-label">Nama Merek Mobil</label><div class="form-field-container"><input type="text" id="brandName" class="form-input" placeholder="Contoh: Toyota, Honda" required></div></div>
                        <div class="form-group"><label for="brandColor" class="form-label">Warna Tema Merek</label><div class="form-field-container"><input type="color" id="brandColor" class="form-input h-12 p-1" value="#DC2626"></div></div>
                        <div class="form-group"><label for="namaPanggilan" class="form-label">Nama Panggilan Anda</label><div class="form-field-container"><input type="text" id="namaPanggilan" class="form-input" placeholder="Contoh: Budi" required></div></div>
                        <div class="form-group"><label for="namaLengkap" class="form-label">Nama Lengkap Anda</label><div class="form-field-container"><input type="text" id="namaLengkap" class="form-input" placeholder="Contoh: Budi Santoso"></div></div>
                        <div class="form-group"><label for="kota" class="form-label">Kota Operasi</label><div class="form-field-container"><input type="text" id="kota" class="form-input" placeholder="Contoh: Jakarta"></div></div>
                        <div class="form-group"><label for="noWhatsapp" class="form-label">Nomor WhatsApp</label><div class="form-field-container"><input type="text" id="noWhatsapp" class="form-input" placeholder="628123..." required><p class="text-sm text-gray-500 mt-1">Gunakan format internasional, contoh: <strong>6281234567890</strong>. Tanpa spasi atau simbol.</p></div></div>
                        <div class="form-group"><label for="linkInstagram" class="form-label">Link Instagram</label><div class="form-field-container"><input type="url" id="linkInstagram" class="form-input" placeholder="https://instagram.com/user"></div></div>
                        <div class="form-group">
                            <label class="form-label">Logo Merek (Opsional)</label>
                            <div class="form-field-container image-editor" data-aspect-ratio="0"><input type="hidden" class="image-data-input" id="logoPerusahaan_data"><label class="image-preview-container h-8 max-w-[160px]"><img id="logoPerusahaan_preview" class="image-preview" src="https://placehold.co/150x50/e2e8f0/9ca3af?text=Logo"><div class="overlay rounded-lg"><span class="overlay-button">Ganti Gambar</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan Crop</button></div></div>
                        </div>
                    </div>
                </div>

                <div id="page-judul" class="page-content hidden">
                    <div class="section-card">
                        <h2 class="section-header">Bagian Judul & Slide</h2>
                        <div class="form-group">
                            <label class="form-label">Foto Profil Anda</label>
                            <div class="form-field-container image-editor" data-aspect-ratio="1"><input type="hidden" class="image-data-input" id="fotoProfil_data"><label class="image-preview-container h-32 w-32 rounded-full"><img id="fotoProfil_preview" class="image-preview rounded-full" src="https://placehold.co/300x300/e2e8f0/9ca3af?text=Foto+Profil"><div class="overlay rounded-full"><span class="overlay-button">Ganti</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan Crop</button></div><p class="text-sm text-gray-500 mt-1 sm:text-left text-center">Rekomendasi rasio <strong>1:1</strong> (persegi). Foto ini akan muncul di bagian atas halaman utama.</p></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gambar Latar Belakang Slide</label>
                            <div class="form-field-container">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div class="image-editor" data-aspect-ratio="1.777"><input type="hidden" class="image-data-input" id="backgroundHero1_data"><label class="image-preview-container h-32"><img id="backgroundHero1_preview" class="image-preview-wide" src="https://placehold.co/800x450/e2e8f0/9ca3af?text=Gambar+1"><div class="overlay rounded-lg"><span class="overlay-button">Ganti</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan</button></div></div>
                                    <div class="image-editor" data-aspect-ratio="1.777"><input type="hidden" class="image-data-input" id="backgroundHero2_data"><label class="image-preview-container h-32"><img id="backgroundHero2_preview" class="image-preview-wide" src="https://placehold.co/800x450/e2e8f0/9ca3af?text=Gambar+2"><div class="overlay rounded-lg"><span class="overlay-button">Ganti</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan</button></div></div>
                                    <div class="image-editor" data-aspect-ratio="1.777"><input type="hidden" class="image-data-input" id="backgroundHero3_data"><label class="image-preview-container h-32"><img id="backgroundHero3_preview" class="image-preview-wide" src="https://placehold.co/800x450/e2e8f0/9ca3af?text=Gambar+3"><div class="overlay rounded-lg"><span class="overlay-button">Ganti</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan</button></div></div>
                                </div>
                                <p class="text-sm text-gray-500 mt-2">Rekomendasi rasio <strong>16:9</strong> (lanskap). Gambar ini menjadi latar belakang utama di bagian paling atas website. Unggah lebih dari satu untuk membuat slideshow.</p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="backgroundInterval" class="form-label">Interval Pindah Gambar (detik)</label>
                            <div class="form-field-container">
                                <input type="number" id="backgroundInterval" class="form-input" placeholder="Contoh: 5" value="5">
                                <p class="text-sm text-gray-500 mt-1">Durasi (dalam detik) sebelum gambar latar belakang berganti. Isi dengan <strong>0</strong> untuk mematikan slide.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-mobil" class="page-content hidden">
                    <div class="section-card">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 border-b border-gray-200 pb-4">
                            <h2 class="section-header !mb-0 !border-b-0">Daftar Mobil</h2>
                            <button type="button" id="show-mobil-modal-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors inline-flex items-center justify-center gap-2">
                                <span>Tambah Mobil Baru</span>
                            </button>
                        </div>
                        <div id="mobil-list-display" class="space-y-4"></div>
                    </div>
                </div>
                
                <div id="page-promo" class="page-content hidden">
                    <div class="section-card">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 border-b border-gray-200 pb-4">
                            <h2 class="section-header !mb-0 !border-b-0">Promo</h2>
                            <button type="button" id="add-promo-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors inline-flex items-center justify-center gap-2">
                                <span>Tambah Promo</span>
                            </button>
                        </div>
                        <div id="promo-list-container" class="space-y-6"></div>
                    </div>
                </div>

                <div id="page-testimoni" class="page-content hidden">
                    <div class="section-card">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 border-b border-gray-200 pb-4">
                            <h2 class="section-header !mb-0 !border-b-0">Testimoni</h2>
                            <button type="button" id="add-testimoni-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors inline-flex items-center justify-center gap-2">
                                <span>Tambah Testimoni</span>
                            </button>
                        </div>
                        <div id="testimoni-list-container" class="space-y-6"></div>
                    </div>
                </div>

                <div id="page-galeri" class="page-content hidden">
                    <div class="section-card">
                         <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 border-b border-gray-200 pb-4">
                            <h2 class="section-header !mb-0 !border-b-0">Galeri Penyerahan</h2>
                            <button type="button" id="add-galeri-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors inline-flex items-center justify-center gap-2">
                                <span>Tambah Foto Galeri</span>
                            </button>
                        </div>
                        <div id="galeri-list-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    </div>
                </div>
                
                <div id="page-data" class="page-content hidden">
                    <div class="section-card">
                        <h2 class="section-header">Manajemen Data</h2>
                        <p class="text-gray-600 mb-6">Gunakan fitur ini untuk mencadangkan (backup) data Anda atau memindahkannya ke browser/perangkat lain.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <label class="bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition-colors cursor-pointer text-center inline-flex items-center justify-center gap-2"><span>Impor Data (.json)</span><input type="file" id="import-input" class="hidden" accept=".json"></label>
                            <button type="button" id="export-button" class="bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors inline-flex items-center justify-center gap-2"><span>Ekspor Data (.json)</span></button>
                        </div>
                        <div class="mt-8 pt-6 border-t border-red-200">
                            <h3 class="text-lg font-semibold text-red-700">Zona Berbahaya</h3>
                            <p class="text-gray-600 mt-2 mb-4">Tindakan ini akan menghapus semua data yang telah Anda masukkan di browser ini. Tindakan ini tidak dapat dibatalkan.</p>
                            <button type="button" id="reset-button" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">Reset Semua Data</button>
                        </div>
                    </div>
                </div>
            </form>
        </main>
    </div>

    <div id="mobil-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header p-5 border-b flex justify-between items-center bg-white rounded-t-2xl">
                <h3 id="modal-title" class="text-xl font-bold text-gray-800">Tambah Mobil Baru</h3>
                <button id="modal-close-btn" type="button" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="mobil-form-container"></div>
            </div>
            <div class="modal-footer p-5 border-t flex justify-end gap-4 bg-white/50 rounded-b-2xl">
                <button id="modal-cancel-btn" type="button" class="bg-gray-200 text-gray-800 font-semibold px-6 py-2.5 rounded-lg hover:bg-gray-300">Batal</button>
                <button id="modal-save-btn" type="button" class="bg-indigo-600 text-white font-semibold px-6 py-2.5 rounded-lg hover:bg-indigo-700">Simpan</button>
            </div>
        </div>
    </div>

    <template id="mobil-form-template">
        <div class="space-y-5">
            <div class="form-group"><label class="form-label">Nama Model Mobil</label><div class="form-field-container"><input type="text" class="form-input data-field" data-key="nama" placeholder="Contoh: Kijang Innova Zenix"></div></div>
            <div class="form-group"><label class="form-label">Harga Mulai (Tampilan Awal)</label><div class="form-field-container"><input type="text" class="form-input data-field" data-key="harga" placeholder="Contoh: Mulai 400 Jutaan"></div></div>
            <div class="form-group">
                <label class="form-label">Gambar Utama Mobil</label>
                <div class="form-field-container image-editor" data-aspect-ratio="1.5"><input type="hidden" class="image-data-input data-field" data-key="img"><label class="image-preview-container h-40"><img class="image-preview-wide" src="https://placehold.co/600x400/e2e8f0/9ca3af?text=Preview"><div class="overlay rounded-lg"><span class="overlay-button">Ganti Gambar</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan Crop</button></div></div>
            </div>
            <div class="mt-6 pt-4 border-t border-gray-200">
                <h3 class="form-label text-base">Tabel Varian, Harga, & Cicilan</h3>
                <div class="tipe-mobil-list space-y-3"></div>
                <button type="button" class="add-tipe-btn mt-3 text-sm bg-gray-600 text-white px-3 py-1.5 rounded-md hover:bg-gray-700 inline-flex items-center gap-2"><span>Tambah Varian Tipe</span></button>
            </div>
        </div>
    </template>
    
    <template id="mobil-list-item-template">
        <div class="mobil-list-item">
            <span class="drag-handle-mobil">☰</span>
            <img class="w-20 h-14 object-cover rounded-md bg-gray-200" src="https://placehold.co/600x400/e2e8f0/9ca3af?text=Mobil">
            <div class="flex-grow">
                <p class="font-semibold text-gray-800">Nama Mobil</p>
            </div>
            <div class="flex gap-2">
                <button type="button" class="edit-mobil-btn action-btn bg-yellow-100 text-yellow-800 hover:bg-yellow-200">Ubah</button>
                <button type="button" class="delete-mobil-btn action-btn bg-red-100 text-red-800 hover:bg-red-200">Hapus</button>
            </div>
        </div>
    </template>

    <template id="tipe-mobil-row-template">
        <div class="tipe-entry grid grid-cols-1 sm:grid-cols-5 gap-3 items-end p-4 bg-slate-100 rounded-lg border">
            <div class="sm:col-span-2"><label class="text-xs font-medium text-gray-500">Tipe / Varian</label><input type="text" class="form-input w-full mt-1 tipe-data" data-key="nama" placeholder="G, V, Q Hybrid"></div>
            <div class="flex-grow"><label class="text-xs font-medium text-gray-500">Harga OTR</label><input type="text" class="form-input w-full mt-1 tipe-data" data-key="harga" placeholder="4xx.xxx.xxx"></div>
            <div class="flex-grow"><label class="text-xs font-medium text-gray-500">DP</label><input type="text" class="form-input w-full mt-1 tipe-data" data-key="dp" placeholder="80 Jutaan"></div>
            <div class="flex-grow"><label class="text-xs font-medium text-gray-500">Cicilan</label><input type="text" class="form-input w-full mt-1 tipe-data" data-key="cicilan" placeholder="8 Jutaan / 60x"></div>
            <button type="button" class="delete-tipe-btn bg-red-100 text-red-600 h-11 w-full sm:w-11 flex items-center justify-center rounded-lg hover:bg-red-200 transition-colors text-sm font-medium">Hapus</button>
        </div>
    </template>
    
    <template id="promo-entry-template">
        <div class="dynamic-entry">
            <div class="drag-handle">☰</div>
            <button type="button" class="delete-btn">×</button>
            <div class="space-y-5">
                <div class="form-group"><label class="form-label">Judul Promo</label><div class="form-field-container"><input type="text" class="form-input data-field" data-key="judul"></div></div>
                <div class="form-group"><label class="form-label">Deskripsi Singkat</label><div class="form-field-container"><textarea class="form-textarea data-field" data-key="deskripsi" rows="2"></textarea></div></div>
                <div class="form-group"><label class="form-label">Gambar Latar Promo</label><div class="form-field-container image-editor" data-aspect-ratio="1.5"><input type="hidden" class="image-data-input data-field" data-key="img"><label class="image-preview-container h-40"><img class="image-preview-wide" src="https://placehold.co/600x400/e2e8f0/9ca3af?text=Preview"><div class="overlay rounded-lg"><span class="overlay-button">Ganti Gambar</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan Crop</button></div></div></div>
            </div>
        </div>
    </template>
    <template id="testimoni-entry-template">
        <div class="dynamic-entry">
            <div class="drag-handle">☰</div>
            <button type="button" class="delete-btn">×</button>
            <div class="space-y-5">
                <div class="form-group"><label class="form-label">Isi Testimoni</label><div class="form-field-container"><textarea class="form-textarea data-field" data-key="quote" rows="3"></textarea></div></div>
                <div class="form-group"><label class="form-label">Nama Pelanggan</label><div class="form-field-container"><input type="text" class="form-input data-field" data-key="nama"></div></div>
                <div class="form-group">
                    <label class="form-label">Keterangan</label>
                    <div class="form-field-container">
                        <input type="text" class="form-input data-field" data-key="jabatan" placeholder="Contoh: Pembelian Mobil Avanza">
                        <p class="text-sm text-gray-500 mt-1">Deskripsi singkat ini akan muncul di bawah nama pelanggan. (Contoh: "Pembeli All New Avanza", "Karyawan Swasta")</p>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Foto Pelanggan</label><div class="form-field-container image-editor" data-aspect-ratio="1"><input type="hidden" class="image-data-input data-field" data-key="img"><label class="image-preview-container h-24 w-24 rounded-full"><img class="image-preview rounded-full" src="https://placehold.co/100x100/e2e8f0/9ca3af?text=Preview"><div class="overlay rounded-full"><span class="overlay-button">Ganti</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan Crop</button></div></div></div>
            </div>
        </div>
    </template>
    <template id="galeri-entry-template">
        <div class="dynamic-entry">
            <div class="drag-handle">☰</div>
            <button type="button" class="delete-btn">×</button>
            <div class="space-y-5">
                <div class="form-group"><label class="form-label">Foto Serah Terima</label><div class="form-field-container image-editor" data-aspect-ratio="1.333"><input type="hidden" class="image-data-input data-field" data-key="img"><label class="image-preview-container h-40"><img class="image-preview-wide" src="https://placehold.co/800x600/e2e8f0/9ca3af?text=Preview"><div class="overlay rounded-lg"><span class="overlay-button">Ganti Gambar</span></div><input type="file" class="hidden image-input" accept="image/*"></label><div class="cropper-actions hidden"><button type="button" class="cancel-crop-btn bg-gray-200 px-3 py-1 rounded-md text-sm">Batal</button><button type="button" class="save-crop-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm">Simpan Crop</button></div></div></div>
                <div class="form-group"><label class="form-label">Keterangan Foto</label><div class="form-field-container"><input type="text" class="form-input data-field" data-key="caption"></div></div>
            </div>
        </div>
    </template>

    <div id="save-bar" class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm border-t border-gray-200 p-4 transform translate-y-full transition-transform duration-300 z-40 shadow-t-xl">
        <div class="max-w-7xl mx-auto flex justify-end items-center pl-64">
            <div class="flex items-center gap-4">
                <p id="save-status-text" class="font-medium text-gray-700 transition-colors">Tidak ada perubahan.</p>
                <button type="submit" id="main-save-btn" form="admin-form" disabled class="bg-indigo-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed disabled:shadow-none">
                    Simpan Perubahan
                </button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('admin-form');
        const storageKey = 'salesWebsiteData';
        let websiteData = {}; // Global data object
        let activeCropper = null;
        let currentEditMobilIndex = -1;

        // --- UI ELEMENTS ---
        const pageTitle = document.getElementById('page-title');
        const sidebarNav = document.getElementById('sidebar-nav');
        const pages = document.querySelectorAll('.page-content');
        const saveBar = document.getElementById('save-bar');
        const saveStatusText = document.getElementById('save-status-text');
        const mainSaveBtn = document.getElementById('main-save-btn');
        let hasUnsavedChanges = false;
        
        // --- MOBIL MODAL ELEMENTS ---
        const mobilModal = document.getElementById('mobil-modal');
        const mobilFormContainer = document.getElementById('mobil-form-container');
        const showMobilModalBtn = document.getElementById('show-mobil-modal-btn');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalSaveBtn = document.getElementById('modal-save-btn');
        const modalTitle = document.getElementById('modal-title');

        // --- PAGE NAVIGATION ---
        function showPage(pageId) {
            pages.forEach(page => page.classList.add('hidden'));
            const activePage = document.getElementById(`page-${pageId}`);
            if (activePage) activePage.classList.remove('hidden');
            
            sidebarNav.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === pageId) {
                    link.classList.add('active');
                    pageTitle.textContent = link.querySelector('span').textContent;
                }
            });
            window.location.hash = pageId;
        }

        sidebarNav.addEventListener('click', (e) => {
            const link = e.target.closest('.nav-link');
            if (link && link.dataset.page) {
                e.preventDefault();
                showPage(link.dataset.page);
            }
        });

        function handleInitialPageLoad() {
            const hash = window.location.hash.substring(1);
            const validPages = Array.from(sidebarNav.querySelectorAll('.nav-link')).map(l => l.dataset.page);
            if (hash && validPages.includes(hash)) {
                showPage(hash);
            } else {
                showPage('branding'); // Default to the first page
            }
        }

        // --- SAVE BAR ---
        function setUnsavedChanges(isUnsaved) {
            hasUnsavedChanges = isUnsaved;
            if (isUnsaved) {
                saveBar.classList.remove('translate-y-full');
                mainSaveBtn.disabled = false;
                saveStatusText.textContent = 'Anda memiliki perubahan yang belum disimpan.';
                saveStatusText.className = 'font-medium text-yellow-700 transition-colors';
            } else {
                saveBar.classList.add('translate-y-full');
                mainSaveBtn.disabled = true;
                saveStatusText.textContent = 'Tidak ada perubahan.';
                saveStatusText.className = 'font-medium text-gray-700 transition-colors';
            }
        }
        form.addEventListener('input', () => { if (!hasUnsavedChanges) { setUnsavedChanges(true); } });

        // --- IMAGE CROPPER ---
        function startInlineCropping(editorDiv, file) { if (activeCropper) activeCropper.cancelBtn.click(); const previewContainer = editorDiv.querySelector('.image-preview-container'); const actionsContainer = editorDiv.querySelector('.cropper-actions'); const tempImg = document.createElement('img'); const aspectRatio = parseFloat(editorDiv.dataset.aspectRatio) || NaN; const reader = new FileReader(); reader.onload = e => { tempImg.src = e.target.result; previewContainer.classList.add('hidden'); editorDiv.insertBefore(tempImg, actionsContainer); actionsContainer.classList.remove('hidden'); const cropper = new Cropper(tempImg, { aspectRatio, viewMode: 1, background: false, autoCropArea: 0.9 }); activeCropper = { instance: cropper, imgElement: tempImg, previewContainer, actionsContainer, saveBtn: actionsContainer.querySelector('.save-crop-btn'), cancelBtn: actionsContainer.querySelector('.cancel-crop-btn') }; }; reader.readAsDataURL(file); }
        function endInlineCropping(save) { if (!activeCropper) return; const { instance, imgElement, previewContainer, actionsContainer } = activeCropper; if (save) { const canvas = instance.getCroppedCanvas({ maxWidth: 1200, maxHeight: 1200, imageSmoothingQuality: 'high' }); const base64 = canvas.toDataURL('image/jpeg', 0.85); previewContainer.querySelector('img').src = base64; const hiddenInput = previewContainer.closest('.image-editor').querySelector('.image-data-input'); if (hiddenInput) { hiddenInput.value = base64; hiddenInput.dispatchEvent(new Event('input', { bubbles: true })); } } instance.destroy(); imgElement.remove(); previewContainer.classList.remove('hidden'); actionsContainer.classList.add('hidden'); activeCropper = null; }
        function setupImageInput(element) { element.querySelectorAll('.image-input').forEach(input => { input.addEventListener('change', e => { if (e.target.files[0]) startInlineCropping(e.target.closest('.image-editor'), e.target.files[0]); }); }); element.querySelectorAll('.save-crop-btn').forEach(btn => btn.onclick = () => endInlineCropping(true)); element.querySelectorAll('.cancel-crop-btn').forEach(btn => btn.onclick = () => endInlineCropping(false)); }

        // --- MOBIL MODAL & LIST FUNCTIONS ---
        function openMobilModal(index = -1) {
            currentEditMobilIndex = index;
            mobilFormContainer.innerHTML = ''; // Clear previous form
            const template = document.getElementById('mobil-form-template');
            const clone = template.content.cloneNode(true);
            
            const data = (index > -1 && websiteData.daftarMobil) ? websiteData.daftarMobil[index] : {};

            clone.querySelectorAll('.data-field').forEach(field => {
                const key = field.dataset.key;
                if (data[key]) {
                    if (field.classList.contains('image-data-input')) {
                        field.value = data[key];
                        clone.querySelector('.image-preview-wide').src = data[key];
                    } else {
                        field.value = data[key];
                    }
                }
            });

            if (data.tipeList) {
                const tipeContainer = clone.querySelector('.tipe-mobil-list');
                data.tipeList.forEach(tipeData => createTipeEntry(tipeContainer, tipeData));
            }

            mobilFormContainer.appendChild(clone);
            setupImageInput(mobilFormContainer);
            mobilFormContainer.querySelector('.add-tipe-btn').addEventListener('click', (e) => {
                createTipeEntry(e.target.closest('.space-y-5').querySelector('.tipe-mobil-list'));
            });

            modalTitle.textContent = index > -1 ? 'Ubah Data Mobil' : 'Tambah Mobil Baru';
            mobilModal.classList.remove('hidden');
        }

        function closeMobilModal() { mobilModal.classList.add('hidden'); mobilFormContainer.innerHTML = ''; }

        function saveMobilData() {
            const entryData = {};
            mobilFormContainer.querySelectorAll('.data-field').forEach(field => entryData[field.dataset.key] = field.value);
            const tipeList = [];
            mobilFormContainer.querySelectorAll('.tipe-entry').forEach(tipeRow => { const tipeData = {}; tipeRow.querySelectorAll('.tipe-data').forEach(tipeField => tipeData[tipeField.dataset.key] = tipeField.value); tipeList.push(tipeData); });
            entryData.tipeList = tipeList;
            if (!websiteData.daftarMobil) websiteData.daftarMobil = [];
            if (currentEditMobilIndex > -1) { websiteData.daftarMobil[currentEditMobilIndex] = entryData; } else { websiteData.daftarMobil.push(entryData); }
            renderMobilList();
            setUnsavedChanges(true);
            closeMobilModal();
        }

        function renderMobilList() {
            const container = document.getElementById('mobil-list-display');
            container.innerHTML = '';
            if (!websiteData.daftarMobil) return;
            
            websiteData.daftarMobil.forEach((mobil, index) => {
                const template = document.getElementById('mobil-list-item-template');
                const clone = template.content.cloneNode(true);
                const item = clone.querySelector('.mobil-list-item');
                item.dataset.index = index;
                clone.querySelector('p').textContent = mobil.nama || 'Tanpa Nama';
                if (mobil.img) { clone.querySelector('img').src = mobil.img; }
                clone.querySelector('.edit-mobil-btn').addEventListener('click', () => openMobilModal(index));
                clone.querySelector('.delete-mobil-btn').addEventListener('click', () => { if (confirm(`Yakin ingin menghapus mobil "${mobil.nama || ''}"?`)) { websiteData.daftarMobil.splice(index, 1); renderMobilList(); setUnsavedChanges(true); } });
                container.appendChild(clone);
            });
        }

        // --- OTHER DYNAMIC CONTENT FUNCTIONS ---
        function createTipeEntry(container, data = {}) { const template = document.getElementById('tipe-mobil-row-template'); const clone = template.content.cloneNode(true); const entryElement = clone.querySelector('.tipe-entry'); entryElement.querySelectorAll('.tipe-data').forEach(field => { if (data[field.dataset.key]) field.value = data[field.dataset.key]; }); entryElement.querySelector('.delete-tipe-btn').addEventListener('click', () => {entryElement.remove(); setUnsavedChanges(true);}); container.appendChild(entryElement); }
        function createDynamicEntry(container, template, data = {}) { const clone = template.content.cloneNode(true); const entryElement = clone.querySelector('.dynamic-entry'); entryElement.querySelectorAll('.data-field').forEach(field => { const key = field.dataset.key; if (data[key] && field.type !== 'hidden') field.value = data[key]; if (data[key] && field.classList.contains('image-data-input')) { field.value = data[key]; const previewImg = entryElement.querySelector('.image-preview, .image-preview-wide'); if(previewImg) previewImg.src = data[key]; } }); entryElement.querySelector('.delete-btn')?.addEventListener('click', () => {entryElement.remove(); setUnsavedChanges(true);}); setupImageInput(entryElement); container.appendChild(entryElement); }

        function setupAddButtons() {
            const sections = [ { btn: 'add-promo-btn', container: 'promo-list-container', template: 'promo-entry-template' }, { btn: 'add-testimoni-btn', container: 'testimoni-list-container', template: 'testimoni-entry-template' }, { btn: 'add-galeri-btn', container: 'galeri-list-container', template: 'galeri-entry-template' } ];
            sections.forEach(sec => { document.getElementById(sec.btn).addEventListener('click', () => { createDynamicEntry(document.getElementById(sec.container), document.getElementById(sec.template)); setUnsavedChanges(true); }); });
        }
        
        function initializeSortable(containerId, handleClass) { const container = document.getElementById(containerId); if (!container) return; new Sortable(container, { animation: 150, handle: handleClass, ghostClass: 'bg-blue-100', onEnd: (evt) => { if (containerId === 'mobil-list-display') { const movedItem = websiteData.daftarMobil.splice(evt.oldIndex, 1)[0]; websiteData.daftarMobil.splice(evt.newIndex, 0, movedItem); } setUnsavedChanges(true); } }); }

        // --- MAIN DATA HANDLING ---
        function collectDataFromForm() {
            const finalData = { ...websiteData };
            
            form.querySelectorAll('input:not([type="file"]), textarea, input[type="color"]').forEach(input => {
                if (input.id && !input.closest('.dynamic-entry') && !input.closest('#mobil-modal')) {
                    finalData[input.id] = input.value;
                }
            });
            form.querySelectorAll('.image-data-input').forEach(input => {
                if (input.id && !input.closest('.dynamic-entry') && !input.closest('#mobil-modal')) {
                    finalData[input.id.replace('_data', '')] = input.value;
                }
            });

            const sections = [ { key: 'daftarPromo', container: 'promo-list-container' }, { key: 'daftarTestimoni', container: 'testimoni-list-container' }, { key: 'daftarGaleri', container: 'galeri-list-container' } ];
            sections.forEach(sec => { const entries = []; document.getElementById(sec.container).querySelectorAll('.dynamic-entry').forEach(el => { const entryData = {}; el.querySelectorAll('.data-field').forEach(field => entryData[field.dataset.key] = field.value); entries.push(entryData); }); finalData[sec.key] = entries; });
            
            return finalData;
        }

        function populateForm(data) {
            if (!data) return;
            websiteData = JSON.parse(JSON.stringify(data));
            
            form.querySelectorAll('input:not([type="file"]), textarea, input[type="color"]').forEach(input => { if (data[input.id] !== undefined) input.value = data[input.id]; });
            form.querySelectorAll('.image-data-input').forEach(input => { const key = input.id.replace('_data', ''); if (data[key]) { input.value = data[key]; document.getElementById(`${key}_preview`).src = data[key]; } });
            
            renderMobilList();
            const sections = [ { key: 'daftarPromo', container: 'promo-list-container', template: 'promo-entry-template' }, { key: 'daftarTestimoni', container: 'testimoni-list-container', template: 'testimoni-entry-template' }, { key: 'daftarGaleri', container: 'galeri-list-container', template: 'galeri-entry-template' } ];
            sections.forEach(sec => { const container = document.getElementById(sec.container); const template = document.getElementById(sec.template); container.innerHTML = ''; if (data[sec.key]) { data[sec.key].forEach(itemData => createDynamicEntry(container, template, itemData)); } });

            // Update UI elements based on data
            document.getElementById('sidebar-brand-name').textContent = data.brandName || 'Admin Panel';
            document.getElementById('topbar-admin-name').textContent = data.namaPanggilan || 'Sales Person';
            if (data.logoPerusahaan) document.getElementById('topbar-logo').src = data.logoPerusahaan;
        }

        async function saveData() {
            mainSaveBtn.disabled = true;
            mainSaveBtn.textContent = 'Menyimpan...';

            saveStatusText.textContent = 'Perubahan sedang disimpan...';
            const dataToSave = collectDataFromForm();
            localStorage.setItem(storageKey, JSON.stringify(dataToSave));
            websiteData = JSON.parse(JSON.stringify(dataToSave));
            
            setTimeout(() => {
                mainSaveBtn.textContent = 'Berhasil Disimpan!';
                mainSaveBtn.classList.replace('bg-indigo-600', 'bg-green-600');
                saveStatusText.textContent = 'Semua perubahan telah disimpan.';
                
                setTimeout(() => {
                    setUnsavedChanges(false);
                    mainSaveBtn.textContent = 'Simpan Perubahan';
                    mainSaveBtn.classList.replace('bg-green-600', 'bg-indigo-600');
                }, 2000);
            }, 500);
        }

        function loadData() {
            const data = JSON.parse(localStorage.getItem(storageKey)) || {};
            populateForm(data);
            initializeSortable('mobil-list-display', '.drag-handle-mobil');
            initializeSortable('promo-list-container', '.drag-handle');
            initializeSortable('testimoni-list-container', '.drag-handle');
            initializeSortable('galeri-list-container', '.drag-handle');
        }

        // --- EVENT LISTENERS ---
        form.addEventListener('submit', (e) => { e.preventDefault(); saveData(); });
        document.getElementById('reset-button').addEventListener('click', () => { if (confirm('YAKIN INGIN RESET SEMUA DATA?\n\nTindakan ini akan menghapus semua pengaturan dan konten yang telah Anda masukkan di browser ini. Data tidak dapat dibatalkan.')) { localStorage.removeItem(storageKey); window.location.reload(); } });
        document.getElementById('export-button').addEventListener('click', () => { const data = localStorage.getItem(storageKey); if (!data) { alert('Tidak ada data untuk diekspor.'); return; } const blob = new Blob([data], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.download = 'data_website_sales.json'; a.href = url; a.click(); URL.revokeObjectURL(url); a.remove(); });
        document.getElementById('import-input').addEventListener('change', (event) => { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); populateForm(data); setUnsavedChanges(true); saveStatusText.textContent = 'Data berhasil diimpor! Klik "Simpan Perubahan" untuk menyimpan.'; alert('Data berhasil diimpor! Jangan lupa untuk menyimpan perubahan.'); } catch (err) { alert('File tidak valid atau rusak.'); console.error(err); } }; reader.readAsText(file); });
        
        showMobilModalBtn.addEventListener('click', () => openMobilModal(-1));
        modalCloseBtn.addEventListener('click', closeMobilModal);
        modalCancelBtn.addEventListener('click', closeMobilModal);
        modalSaveBtn.addEventListener('click', saveMobilData);
        
        // --- INITIALIZATION ---
        setupAddButtons();
        setupImageInput(document.body);
        loadData();
        handleInitialPageLoad();
    });
    </script>
</body>
</html>